<?xml version='1.0' encoding='UTF-8' ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html lang="es" xmlns="http://www.w3.org/1999/xhtml"
      xmlns:h="http://java.sun.com/jsf/html"
      xmlns:f="http://java.sun.com/jsf/core"
      xmlns:ui="http://java.sun.com/jsf/facelets"
      xmlns:p="http://xmlns.jcp.org/jsf/passthrough"
      xmlns:c="http://xmlns.jcp.org/jsp/jstl/core"
      >
    <h:head rendered="#{CUsuario.soloVisibleParaAdmin(true)}">
        <ui:include src="/menu.xhtml"/>
        <style>
            .button {
                background:none!important;
                border:none; 
                padding:0!important;
                /*border is optional*/
                border-bottom:1px solid #444; 
                color: blue;
                border-bottom-color: blue;
            }
        </style>
    </h:head>
    <h:body>
        <div class="container">
            <div class="well col-sm-12 col-md-8 col-md-offset-2">
                <ui:repeat value="${CUsuario.all}" var="usr">
                    <div class="row user-row">
                        <div class="col-md-1">
                            <img class="img-circle"
                                 src="Imgs/user50.png"
                                 alt="User Pic"/>
                        </div>
                        <div class="col-md-10">
                            <strong>${usr.username} <ui:fragment rendered="${!usr.isActivo()}">(inactivo)</ui:fragment></strong>
                            <span class="text-muted">Tipo de usuario: <ui:fragment rendered="${usr.esAdmin()}">Administrador</ui:fragment><ui:fragment rendered="${!usr.esAdmin()}">Cliente</ui:fragment></span>
                        </div>
                        <!-- add .rowname class to attribute data-for (Dropdown!)-->
                        <div class="col-md-1 dropdown-user" data-for=".${usr.username}">
                            <i class="glyphicon glyphicon-chevron-down text-muted"></i>
                        </div>
                    </div>

                    <!-- Add data-for class to this row -->
                    <div class="row user-infos ${usr.username}">
                        <div class="col-sm-10 col-md-10 col-md-offset-1">
                            <div class="panel panel-primary">
                                <div class="panel-heading">
                                    <h3 class="panel-title">Información del usuario</h3>
                                </div>
                                <div class="panel-body">
                                    <div class="row">
                                        <div class="col-md-3">
                                            <img class="img-circle"
                                                 src="Imgs/user100.png"
                                                 alt="User Pic"/>
                                        </div>
                                        <div class="col-md-6">
                                            <strong>${usr.username}</strong><br/>
                                            <table class="table table-condensed table-responsive table-user-information">
                                                <tbody>
                                                    <tr>
                                                        <td>Nombre:</td>
                                                        <td>${usr.nombre}</td>
                                                    </tr>
                                                    <tr>
                                                        <td>Apellido:</td>
                                                        <td>${usr.apellido}</td>
                                                    </tr>
                                                    <tr>
                                                        <td>E-mail:</td>
                                                        <td>${usr.email}</td>
                                                    </tr>
                                                    <!-- Info específica del cliente -->
                                                    <ui:fragment rendered="${!usr.esAdmin()}">
                                                        <tr>
                                                            <td>DNI:</td>
                                                            <td>${usr.dni}</td>
                                                        </tr>
                                                        <tr>
                                                            <td>Teléfono:</td>
                                                            <td>${usr.telefono}</td>
                                                        </tr>
                                                        <tr>
                                                            <td>Dirección:</td>
                                                            <td>${usr.direccion}</td>
                                                        </tr>
                                                        <tr>
                                                            <td>Compras:</td>
                                                            <ui:fragment rendered="#{usr.getCompras().isEmpty()}">
                                                                <td><label style="color: red">Sin compras</label></td>
                                                            </ui:fragment>
                                                            <ui:fragment rendered="#{!usr.getCompras().isEmpty()}">
                                                                <h:form>
                                                                    <input type="hidden" name="id" value="${usr.id}"/>
                                                                    <td>
                                                                        <h:commandButton action="#{CUsuario.prepararCompras()}" styleClass="button" value="Ver"/>
                                                                    </td>
                                                                </h:form>
                                                            </ui:fragment>
                                                        </tr>
                                                    </ui:fragment>
                                                </tbody>
                                            </table>
                                        </div>
                                    </div>
                                </div>
                                <div class="panel-footer">
                                    <button class="btn btn-sm btn-primary" type="button" onclick="javascript:window.location = 'mailto:${usr.email}&amp;subject=Contacto'"
                                            data-toggle="tooltip"
                                            data-original-title="Enviar mensaje a usuario"><i class="glyphicon glyphicon-envelope"></i></button>
                                    <ui:fragment rendered="#{!usr.esAdmin()}">
                                        <span class="pull-right">
                                            <h:form>
                                                <input type="hidden" name="usrId" value="${usr.id}"/>
                                                <h:commandButton styleClass="btn btn-sm btn-warning" 
                                                                 p:data-toggle="tooltip" 
                                                                 p:data-original-title="Editar usuario" 
                                                                 value="Editar"
                                                                 action="#{CUsuario.cargarUsuarioParaEdicion()}">    
                                                </h:commandButton>
                                            </h:form>
                                        </span>
                                    </ui:fragment>
                                </div>
                                <!-- </form> -->
                            </div>
                        </div>
                    </div>
                </ui:repeat>
            </div>
        </div><!-- /.container -->


        <!-- Bootstrap core JavaScript
        ================================================== -->
        <!-- Placed at the end of the document so the pages load faster -->
        <script src="dist/js/userTable.js"></script>
    </h:body>
</html>